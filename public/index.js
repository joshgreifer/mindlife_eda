!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=4)}([function(t,e,i){"use strict";var s=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(t,e,i,s,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,s||t,r),h=n?n+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function h(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)s.call(t,e)&&i.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},u.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o},u.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},u.prototype.emit=function(t,e,i,s,r,o){var a=n?n+t:t;if(!this._events[a])return!1;var h,u,d=this._events[a],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,i),!0;case 4:return d.fn.call(d.context,e,i,s),!0;case 5:return d.fn.call(d.context,e,i,s,r),!0;case 6:return d.fn.call(d.context,e,i,s,r,o),!0}for(u=1,h=new Array(l-1);u<l;u++)h[u-1]=arguments[u];d.fn.apply(d.context,h)}else{var c,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(t,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,e);break;case 3:d[u].fn.call(d[u].context,e,i);break;case 4:d[u].fn.call(d[u].context,e,i,s);break;default:if(!h)for(c=1,h=new Array(l-1);c<l;c++)h[c-1]=arguments[c];d[u].fn.apply(d[u].context,h)}}return!0},u.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},u.prototype.once=function(t,e,i){return a(this,t,e,i,!0)},u.prototype.removeListener=function(t,e,i,s){var r=n?n+t:t;if(!this._events[r])return this;if(!e)return h(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||s&&!o.once||i&&o.context!==i||h(this,r);else{for(var a=0,u=[],d=o.length;a<d;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&u.push(o[a]);u.length?this._events[r]=1===u.length?u[0]:u:h(this,r)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&h(this,e)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},function(t,e,i){var s=i(2),n=i(3),r="undefined"!=typeof Float64Array;function o(t,e){return t[0]-e[0]}function a(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(o);var s=new Array(i.length);for(t=0;t<s.length;++t)s[t]=i[t][1];return s}function h(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var n="generic"===t;if(-1===e){var r="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(r)()}if(0===e){r="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",r)(u[t][0])}r=["'use strict'"];var o=s(e),h=o.map((function(t){return"i"+t})),d="this.offset+"+o.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),l=o.map((function(t){return"b"+t})).join(","),c=o.map((function(t){return"c"+t})).join(",");r.push("function "+i+"(a,"+l+","+c+",d){this.data=a","this.shape=["+l+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),r.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+o.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),e<4?(r.push("function "+i+"_order(){"),2===e?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+i+"_set("+h.join(",")+",v){"),n?r.push("return this.data.set("+d+",v)}"):r.push("return this.data["+d+"]=v}"),r.push("proto.get=function "+i+"_get("+h.join(",")+"){"),n?r.push("return this.data.get("+d+")}"):r.push("return this.data["+d+"]}"),r.push("proto.index=function "+i+"_index(",h.join(),"){return "+d+"}"),r.push("proto.hi=function "+i+"_hi("+h.join(",")+"){return new "+i+"(this.data,"+o.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+o.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var f=o.map((function(t){return"a"+t+"=this.shape["+t+"]"})),p=o.map((function(t){return"c"+t+"=this.stride["+t+"]"}));r.push("proto.lo=function "+i+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+p.join(","));for(var g=0;g<e;++g)r.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");r.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"c"+t})).join(",")+",b)}"),r.push("proto.step=function "+i+"_step("+h.join(",")+"){var "+o.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+o.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<e;++g)r.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");r.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"b"+t})).join(",")+",c)}");var m=new Array(e),w=new Array(e);for(g=0;g<e;++g)m[g]="a[i"+g+"]",w[g]="b[i"+g+"]";r.push("proto.transpose=function "+i+"_transpose("+h+"){"+h.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+m.join(",")+","+w.join(",")+",this.offset)}"),r.push("proto.pick=function "+i+"_pick("+h+"){var a=[],b=[],c=this.offset");for(g=0;g<e;++g)r.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+o.map((function(t){return"shape["+t+"]"})).join(",")+","+o.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(u[t],a)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,e,i,s){if(void 0===t)return(0,u.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var o=e.length;if(void 0===i){i=new Array(o);for(var a=o-1,d=1;a>=0;--a)i[a]=d,d*=e[a]}if(void 0===s){s=0;for(a=0;a<o;++a)i[a]<0&&(s-=(e[a]-1)*i[a])}for(var l=function(t){if(n(t))return"buffer";if(r)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),c=u[l];c.length<=o+1;)c.push(h(l,c.length-1));return(0,c[o+1])(t,e,i,s)}},function(t,e,i){"use strict";t.exports=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}},function(t,e){function i(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(i(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&i(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,i){"use strict";i.r(e);class s extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("div"),i=document.createElement("style");e.innerText=this.hasAttribute("value")?this.getAttribute("value"):"(value)",e.className="private-style1",i.textContent="\n        .private-style1 {\n            height: 120px;\n            background-image: linear-gradient(#529610, #2f5609);\n            display: grid;\n            margin: 10px;\n        }\n         \n        .grid {\n            background-image: linear-gradient(#529610, #2f5609);\n            display: grid;\n            row-gap: 0;\n            column-gap: 0;\n            gap: 0;\n            grid-template-columns: repeat(4, auto);\n            grid-template-rows: repeat(4, auto);\n        }\n\n",t.append(i,e)}}class n extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("style"),i=document.createElement("div"),s=document.createElement("div");i.appendChild(s),i.className="console",s.className="console-output",e.textContent="\n        .console {\n            font-size: 13px;\n            overflow: auto;\n            /* height: 50vh; */\n            overflow-y: scroll;\n            overflow-x: scroll;\n            overscroll-behavior-y: contain;\n            scroll-snap-type: y mandatory;\n            grid-area: console;\n        }\n        .console-input {\n            background-color: black;\n            color: #ffffff;\n            font-family: 'Lucida Console', Monaco, monospace;\n        }\n        .console-input input {\n            width: 99%;\n            border: none;\n        }\n        .console-output {\n\n            white-space: pre;\n\n            background-color: black;\n            color: #BCD631;\n            font-family: 'Lucida Console', Monaco, monospace;\n            scroll-snap-align: end;\n\n        }\n        .console-output .error {\n            color: #d60619;\n        }\n        .console-output .info {\n            color: #76fc57;\n        }\n        .console-output .warn {\n            color: #ff8400;\n        }\n";const n=(t,e,i=!1,n=e)=>{let r;const o=s.lastChild;i&&null!==o&&o.className===n?(r=o,r.textContent="",r.classList.remove(n)):r=document.createElement("div"),r.classList.add(e);let a=document.createTextNode(t);r.appendChild(a),r!==o&&s.appendChild(r)};this.log=n,this.warn=t=>{n(t,"warn",!1)},this.info=t=>{n(t,"info",!1)},this.error=t=>{n(t,"error",!1)},t.append(e,i)}}var r,o,a,h;!function(t){t[t.Dash=0]="Dash",t[t.DashDot=1]="DashDot",t[t.DashDotDot=2]="DashDotDot",t[t.Dot=3]="Dot",t[t.Solid=4]="Solid",t[t.Custom=5]="Custom"}(r||(r={}));class u{constructor(t){this.Color=t.Color,this.Width=.5}}class d{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}get right(){return this.x+this.width}set right(t){this.width=t-this.x}get bottom(){return this.y+this.height}set bottom(t){this.height=t-this.y}get Center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}Contains(t,e){return t>=this.x&&e>=this.y&&t<=this.right&&e<=this.bottom}Equals(t){return t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}AssignFrom(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}Clone(){return new d(this.x,this.y,this.width,this.height)}}class l{static setClip(t,e){t.rect(e.x,e.y,e.width,e.height),t.clip()}static GetWorldToGraphicTransform(t,e){const i=t.width/e.width,s=t.height/e.height;return{a:i,b:0,c:0,d:s,e:t.x-e.x*i,f:t.y-e.y*s}}static ApplyTransform(t,e){t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}static SetTransformRect(t,e,i){const s=l.GetWorldToGraphicTransform(e,i);return l.ApplyTransform(t,s),s}static SetOrigin(t,e,i){t.setTransform(1,0,0,1,e,i)}static SetIdentityTransform(t){t.setTransform(1,0,0,1,0,0)}static FillRectangleCoords(t,e,i,s,n,r){t.fillStyle=e.Color,t.fillRect(i,s,n,r)}static FillRectangle(t,e,i){t.fillStyle=e.Color,t.fillRect(i.x,i.y,i.width,i.height)}static FillEllipse(t,e,i,s,n,r){const o=t;o.save(),o.beginPath(),o.translate(i-n,s-r),o.scale(n,r),o.arc(1,1,1,0,2*Math.PI,!1),o.restore(),o.fillStyle=e,o.fill()}static FillCircle(t,e,i,s,n){const r=t;r.save(),r.beginPath(),r.translate(i-n,s-n),r.scale(n,n),r.arc(1,1,1,0,2*Math.PI,!1),r.restore(),r.fillStyle=e,r.fill()}static DrawCircle(t,e,i,s,n){const r=t;r.save(),r.beginPath(),r.translate(i-n,s-n),r.scale(n,n),r.arc(1,1,1,0,2*Math.PI,!1),r.restore(),r.strokeStyle=e,r.stroke()}static DrawRectangleCoords(t,e,i,s,n,r){const o=t;o.lineWidth=e.Width,o.strokeStyle=e.Color,o.setLineDash(e.DashPattern||[]),o.strokeRect(i,s,n,r)}static DrawRectangle(t,e,i){const s=t;s.lineWidth=e.Width,s.strokeStyle=e.Color,s.setLineDash(e.DashPattern||[]),s.strokeRect(i.x,i.y,i.width,i.height)}static DrawString(t,e,i,s,n,r){void 0===r?r={H:o.Left,V:a.Bottom}:(void 0===r.H&&(r.H=o.Left),void 0===r.V&&(r.V=a.Bottom)),t.fillStyle=i,t.textAlign=r.H,t.textBaseline=r.V,t.fillText(e,s,n)}static DrawLine(t,e,i,s,n,r){const o=t;o.strokeStyle=e.Color,o.lineWidth=e.Width,o.setLineDash(e.DashPattern||[]),o.beginPath(),o.moveTo(i,s),o.lineTo(n,r),o.stroke()}}!function(t){t.Left="left",t.Right="right",t.Center="center",t.Start="start",t.End="end"}(o||(o={})),function(t){t.Top="top",t.Hanging="hanging",t.Middle="middle",t.Alphabetic="alphabetic",t.Ideographic="ideographic",t.Bottom="bottom"}(a||(a={}));class c{constructor(t,e,i,s,n){if(this.SZ=t,this.r=new Uint8Array(t+1),this.g=new Uint8Array(t+1),this.b=new Uint8Array(t+1),this.rgba=new Uint32Array(t+1),"interpolate"==e){const e=1/t;let r=0;for(let o=0;o<t;++o)this.r[o]=this.get_interpolated_val(i,r),this.g[o]=this.get_interpolated_val(s,r),this.b[o]=this.get_interpolated_val(n,r),this.rgba[o]=this.r[o]+256*this.g[o]+65536*this.b[o]+4278190080,r+=e}else if("repeat"==e)for(let e=0;e<t;++e)this.r[e]=i[e%i.length],this.g[e]=s[e%s.length],this.b[e]=n[e%n.length],this.rgba[e]=this.r[e]+256*this.g[e]+65536*this.b[e]+4278190080;this.r[t]=this.r[t-1],this.g[t]=this.g[t-1],this.b[t]=this.b[t-1],this.rgba[t]=this.rgba[t-1]}get_interpolated_val(t,e){const i=t.length-1;if(e>=1)return t[i];e<0&&(e=0);let s=e*i;const n=Math.floor(s);return s-=n,t[n]+(t[n+1]-t[n])*s}css_color(t,e=1){if(t<0||t>1)throw new Error("clut.css_color: Parameter must be between 0 and 1.0");return t*=this.SZ,t=Math.floor(t),"rgba("+this.r[t]+","+this.g[t]+","+this.b[t]+", "+e+")"}}!function(t){t.MADNESS=new c(1024,"interpolate",new Uint8Array([0,119,255,17,255,0,255,0,255,255,17,255,0,255,119,255]),new Uint8Array([0,0,102,153,238,102,0,255,255,102,51,238,102,0,255,255]),new Uint8Array([0,17,0,0,102,153,255,238,255,136,153,102,153,255,119,255])),t.HEATMAP=new c(1024,"interpolate",new Uint8Array([0,0,0,0,0,127,255,255,255,127]),new Uint8Array([0,8,255,255,255,255,255,127,0,0]),new Uint8Array([159,255,255,255,127,0,0,0,0,0])),t.GRAYSCALE=new c(1024,"interpolate",new Uint8Array([0,255]),new Uint8Array([0,255]),new Uint8Array([0,255])),t.GRAYSCALE_INVERSE=new c(1024,"interpolate",new Uint8Array([255,0]),new Uint8Array([255,0]),new Uint8Array([255,0])),t.TRAFFIC_LIGHTS=new c(1024,"interpolate",new Uint8Array([207,255,255,0]),new Uint8Array([0,79,207,143]),new Uint8Array([0,0,0,0]))}(h||(h={}));var f=i(0),p=i.n(f);var g,m,w,y,A,x;void 0===g&&(g=document.createElement("canvas")),window.createImageBitmap=async t=>new Promise((e,i)=>{try{const i=(g=g).getContext("2d");i.imageSmoothingEnabled=!1,g.width=t.width,g.height=t.height,i.putImageData(t,0,0),e(g)}catch(t){i(t)}}),function(t){t[t.None=0]="None",t[t.Line=1]="Line",t[t.Bar=2]="Bar",t[t.Segment=3]="Segment",t[t.Step=4]="Step"}(m||(m={})),function(t){t[t.None=0]="None",t[t.Decimate=1]="Decimate",t[t.Avg=2]="Avg",t[t.MinMax=3]="MinMax"}(w||(w={})),function(t){t[t.None=0]="None",t[t.Scroll=1]="Scroll",t[t.Paginate=2]="Paginate",t[t.Fit=3]="Fit"}(y||(y={})),function(t){t[t.None=0]="None",t[t.EnsureAllSamplesVisible=1]="EnsureAllSamplesVisible",t[t.EnsureMostRecentSampleVisible=2]="EnsureMostRecentSampleVisible"}(A||(A={}));class b extends p.a{constructor(t,e=l){super(),this.gch=e,this.offScreenContexts=[],this.currentOffScreenContextsIndex=0,this.canvases=[],this.MIN_GRID_X=10,this.MIN_GRID_Y=10,this.gridMinorX=1,this.gridMajorX=10,this.gridMinorY=100,this.gridMajorY=1e3,this.AxisFont="12px Arial",this.AxisFontHeight=12,this.ButtonFont="16px Arial",this.BackColor="black",this.ForeColor="white",this.AxesBackColor="#1a2630",this.BorderColor="red",this.IS_SPECTROGRAM=!1,this.GridMinorTextColor="#88c5ff",this.GridMajorTextColor="#1c95ff",this.ButtonBackColor=this.AxesBackColor,this.ButtonForeColor="#5ff800",this.ButtonDisabledColor="#6d7a65",this.SampleUnitMultiplier=1,this.fs_=16e3,this.sampleDuration=1/16e3,this.dragPoint={x:0,y:0},this.dragStartPoint={x:0,y:0},this._nchans=0,this.slaves=new Array,this._lineWidth=.1,this.dataTimeOld=-1,this.TimeAxisVisible=!0,this.YAxisVisible=!0,this.SignalFollowBehaviour=y.Paginate,this.AutoYAxisAdjustBehaviour=A.EnsureAllSamplesVisible,this.AutoYAxisAdjustChannel=-1,this._autoYTrack=!0,this._YAxisFormat="0.00",this.captureArea=x.None,this.dataTime=0,this.RenderFrame=async()=>{const t=this.dataTime;if(this.dataTimeOld!==t||!this.dBoundsOld.Equals(this.dBounds)){const e=this.onScreenContext,i=this.offScreenContexts[this.currentOffScreenContextsIndex];++this.currentOffScreenContextsIndex>=1&&(this.currentOffScreenContextsIndex=0);const s=this.offScreenContexts[this.currentOffScreenContextsIndex];(this.TimeAxisVisible||this.YAxisVisible)&&l.FillRectangleCoords(e,{Color:this.AxesBackColor},0,this.yAxisBounds.height,this.timeAxisBounds.x,e.canvas.height),this.TimeAxisVisible&&this.RenderTimeAxis(e),this.RenderYAxis(e),this.RenderButtons(e);let n=this.dBounds.Clone();if(t<n.right&&(n.right=t),n.width>0||0===t){const r=this.pixels2duration(2);this.dBoundsOld.Equals(this.dBounds)?(this.BlitGraph(i,s),await this.RenderGraph(s,this.dataTimeOld-r,t-this.dataTimeOld+r)):(this.RenderGraphBackground(s),await this.RenderGraph(s,n.x,n.width)),this.BlitGraph(s,e),this.dataTimeOld=t,this.RenderGraphGrid(e)}}window.requestAnimationFrame(this.RenderFrame)},this.clut=h.GRAYSCALE;for(let t=0;t<3;++t){const t=document.createElement("canvas");this.canvases.push(t)}for(this.onScreenCanvas=this.canvases[0];t.firstChild;)t.removeChild(t.firstChild);t.appendChild(this.onScreenCanvas),this.onScreenContext=this.onScreenCanvas.getContext("2d"),this.offScreenContexts.push(this.canvases[1].getContext("2d")),this.offScreenContexts.push(this.canvases[2].getContext("2d")),this.currentOffScreenContextsIndex=0,this.master=null,this.penGridMajor=new u({Color:"rgba(25,89,250,0.57)"}),this.penGridMinor=new u({Color:"rgba(68,118,251,0.5)"}),this.penBorder=new u({Color:"Gray"}),this.penGridMinor.DashPattern=[1,3],this.brushGridMajor={Color:"Black"},this.brushGridMinor={Color:"LightGray"},this.penGridMajor.Width=1,this.penGridMinor.Width=1,this.penBorder.Width=1,this.dBounds=new d(0,-1,10,2),this.dBoundsOld=new d(this.dBounds.x,this.dBounds.y,this.dBounds.width,this.dBounds.height),this.captureArea=x.None;const i=t=>{const e=this.onScreenCanvas.getBoundingClientRect();return"touches"in t?[t.touches[0].clientX-e.left,t.touches[0].clientY-e.top]:[t.clientX-e.left,t.clientY-e.top]};this.onScreenCanvas.ontouchstart=this.onScreenCanvas.onmousedown=t=>{t.preventDefault();const[e,s]=i(t);this.captureArea=this.GetArea(e,s),this.dragPoint.x=this.dragStartPoint.x=e-this.gBounds.x,this.dragPoint.y=this.dragStartPoint.y=s},this.onScreenCanvas.ontouchmove=this.onScreenCanvas.onmousemove=t=>{t.preventDefault();const[e,s]=i(t);switch(this.captureArea){case x.Graph:this.graph_Zoom(e-this.gBounds.x,s);break;case x.YAxis:this.yAxis_Scroll(s);break;case x.TimeAxis:this.timeAxis_Scroll(e-this.gBounds.x);break;case x.None:default:switch(this.GetArea(e,s)){case x.TimeAxis:this.onScreenCanvas.style.cursor="ew-resize";break;case x.YAxis:this.onScreenCanvas.style.cursor="ns-resize";break;case x.Graph:this.onScreenCanvas.style.cursor="zoom-in";break;case x.BottomLeft:this.onScreenCanvas.style.cursor="pointer";break;default:this.onScreenCanvas.style.cursor="default"}}},this.onScreenCanvas.ontouchend=this.onScreenCanvas.onmouseup=t=>{if(t.preventDefault(),this.captureArea==x.BottomLeft)switch(this.AutoYAxisAdjustBehaviour){case A.EnsureAllSamplesVisible:this.AutoYAxisAdjustBehaviour=A.None;break;case A.None:default:this.AutoYAxisAdjustBehaviour=A.EnsureAllSamplesVisible}this.captureArea=x.None},this.Resize(),window.requestAnimationFrame(this.RenderFrame)}get GridMinorColor(){return this.penGridMinor.Color}set GridMinorColor(t){this.penGridMinor.Color=t}get GridMajorColor(){return this.penGridMajor.Color}set GridMajorColor(t){this.penGridMajor.Color=t}get Fs(){return this.fs_}set Fs(t){this.fs_=t,this.sampleDuration=1/t}get NumChannels(){return this.ChannelInfo?this.ChannelInfo.length:this._nchans}set NumChannels(t){if(this.ChannelInfo)throw"Can't set number of channels on a scope when its ChannelInfo array is set.";this._nchans=t}AddSlave(t){this.slaves.push(t),t.master=this,t.SignalFollowBehaviour=this.SignalFollowBehaviour,t.DataWidth=this.DataWidth}onData(){this.conn_&&!this.master&&(this.dataTime=this.conn_.CurrentTimeSecs);for(const t of this.slaves)t.dataTime=this.dataTime;switch(this.SignalFollowBehaviour){case y.None:default:break;case y.Scroll:this.DataX=this.dataTime-this.dBounds.width;break;case y.Paginate:this.dataTime>this.dBounds.right&&(this.DataX=this.dBounds.right)}}get Connection(){return this.conn_}set Connection(t){const e=this;void 0!==t&&t.on("data",()=>{e.onData()}),this.conn_=t}get DataX(){return this.dBounds.x}set DataX(t){if(null!=this.master)return void(this.master.DataX=t);const e=this.conn_?this.conn_.CurrentTimeSecs:3600;t<0?t=0:t>e&&(t=e),this.dBounds.x=t;for(let e of this.slaves)e.dBounds.x=t;this.timeAxis_Recalc(),this.emit("TIME-AXIS",{left:t,width:this.dBounds.width})}get DataY(){return this.dBounds.y}set DataY(t){this.dBounds.y=t}get DataWidth(){return this.dBounds.width}set DataWidth(t){if(null===this.master){this.dBounds.width=t;for(let e of this.slaves)e.dBounds.width=t;this.timeAxis_Recalc(),this.emit("TIME-AXIS",{left:this.dBounds.x,width:t})}else this.master.DataWidth=t}get DataHeight(){return this.dBounds.height}set DataHeight(t){this.dBounds.height=t,this.yAxis_Recalc()}Reset(){this.DataX=0,this.conn_&&this.conn_.Reset()}Resize(){const t=this.onScreenCanvas.parentElement.clientWidth,e=this.onScreenCanvas.parentElement.clientHeight,i=this.YAxisVisible?48:0,s=this.TimeAxisVisible?32:0;for(let i of this.canvases)i.width=t,i.height=e;this.yAxisBounds=new d(0,0,i,e-s),this.timeAxisBounds=new d(i,e-s,t-i,s),this.ButtonsBounds=new d(0,e-s,i,s),this.gBounds=new d(i,0,t-i,e-s),this.dataTimeOld=-1}BlitGraph(t,e){if(this.gBounds.width>0)try{const i=t.getImageData(this.gBounds.x,this.gBounds.y,this.gBounds.width,this.gBounds.height);e.putImageData(i,this.gBounds.x,this.gBounds.y)}catch(t){console.log(t)}}BlitAll(t,e){const i=t.getImageData(0,0,this.onScreenCanvas.width,this.onScreenCanvas.height);e.putImageData(i,0,0)}RenderButtons(t){t.font=this.ButtonFont,l.FillRectangle(t,{Color:this.ButtonBackColor},this.ButtonsBounds);const e={H:o.Center,V:a.Middle},i=this.AutoYAxisAdjustBehaviour===A.EnsureAllSamplesVisible?this.ButtonForeColor:this.ButtonDisabledColor;l.DrawString(t,"↕",i,this.ButtonsBounds.x+this.ButtonsBounds.width/2,this.ButtonsBounds.y+this.ButtonsBounds.height/2,e)}RenderTimeAxis(t){const e=this.conn_?this.conn_.StartTimeSecs:0;t.save(),t.font=this.AxisFont,l.setClip(t,this.timeAxisBounds),l.FillRectangle(t,{Color:this.AxesBackColor},this.timeAxisBounds),l.SetOrigin(t,this.timeAxisBounds.x,this.timeAxisBounds.y);const i=this.gridMinorX*Math.floor(this.dBounds.x/this.gridMinorX),s=25<this.duration2pixels(this.gridMinorX);for(let n=i;n<this.dBounds.x+this.dBounds.width;n+=this.gridMinorX){let i=this.time2pixels(n);if(l.DrawLine(t,this.penGridMinor,i,0,i,3),s){const s={H:o.Center,V:a.Top};l.DrawString(t,(e+n).toFixed(2),this.GridMajorTextColor,i+1,4,s)}}for(let i=this.gridMajorX*Math.floor(this.dBounds.x/this.gridMajorX);i<this.dBounds.x+this.dBounds.width;i+=this.gridMajorX){let s=this.time2pixels(i);l.DrawLine(t,this.penGridMajor,s,0,s,4);const n={H:o.Center,V:a.Top};l.DrawString(t,(e+i).toFixed(1),this.GridMajorTextColor,s+1,4,n)}t.restore()}RenderYAxis(t){t.save(),t.font=this.AxisFont,l.setClip(t,this.yAxisBounds),l.FillRectangle(t,{Color:this.AxesBackColor},this.yAxisBounds);const e=this.gridMinorY*Math.floor(this.dBounds.y/this.gridMinorY),i=this.AxisFontHeight<this.d2gHeight(this.gridMinorY);for(let s=e;s<this.dBounds.y+this.dBounds.height;s+=this.gridMinorY){let e=this.d2gY(s);if(l.DrawLine(t,this.penGridMinor,this.yAxisBounds.width-3,e,this.yAxisBounds.width,e),i){const i={H:o.Right,V:a.Middle};l.DrawString(t,s.toFixed(0),this.GridMinorTextColor,this.yAxisBounds.width-5,e,i)}}for(let e=this.gridMajorY*Math.floor(this.dBounds.y/this.gridMajorY);e<this.dBounds.y+this.dBounds.height;e+=this.gridMajorY){let i=this.d2gY(e);l.DrawLine(t,this.penGridMajor,this.yAxisBounds.width-3,i,this.yAxisBounds.width,i);const s={H:o.Right,V:a.Middle};l.DrawString(t,e.toFixed(0),this.GridMajorTextColor,this.yAxisBounds.width-5,i,s)}t.restore()}RenderGraphBackground(t){l.FillRectangle(t,{Color:this.BackColor},this.gBounds)}async RenderGraph(t,e,i){if(this.conn_&&this.conn_.HasData){await this.RenderData(t,e,i)&&this.AdjustYAxis()}else l.DrawString(t,"(No signal)",this.ForeColor,this.gBounds.x+this.gBounds.width/2,this.gBounds.y+this.gBounds.height/2,{H:o.Center,V:a.Middle})}async RenderData(t,e,i){const s=new d(this.dBounds.x,this.SampleUnitMultiplier*(this.dBounds.y+this.dBounds.height),this.dBounds.width,-this.SampleUnitMultiplier*this.dBounds.height),n=new d(0,this.SampleUnitMultiplier*(this.dBounds.y+this.dBounds.height),this.gBounds.width,-this.SampleUnitMultiplier*this.dBounds.height);t.save();let r=-Number.MAX_VALUE,o=Number.MAX_VALUE;const a=this.conn_?this.conn_.TimeToIndex(e):0;let h=Math.floor(i*this.fs_),u=this.conn_?this.conn_.NumFramesRead:0;if(h>u&&(h=u,i=h/this.fs_),h<1)return t.restore(),Promise.resolve(!1);const c=this.samples_per_pixel(),f=this.conn_?this.conn_.Data(e,i):null;if(null===f)return t.restore(),!1;let p=0;if(this.IS_SPECTROGRAM){const i=new d(0*this.fs_,this.SampleUnitMultiplier*(this.dBounds.y+this.dBounds.height),this.dBounds.width*this.fs_,-this.SampleUnitMultiplier*this.dBounds.height),s=new ImageData(this.NumChannels,h),n=new Uint32Array(s.data.buffer),r=h*this.NumChannels,o=a;for(let t=0;t<r;++t){const e=f.data[t+o];n[t]=this.clut.rgba[Math.floor(e*this.clut.SZ)]}const u=await createImageBitmap(s).catch(t=>{});if(!u)return!1;let c=l.GetWorldToGraphicTransform(this.gBounds,i);return l.ApplyTransform(t,c),t.scale(1,-1),t.rotate(-Math.PI/2),t.translate(0,(e-this.dBounds.x)*this.Fs),t.drawImage(u,0,0),t.setTransform(1,0,0,1,0,0),t.restore(),!1}if(this.ChannelInfo)for(let i=0;i<this.NumChannels;++i){if(!1===this.ChannelInfo[i].Visible)continue;const a=i===this.AutoYAxisAdjustChannel,u=this.ChannelInfo[i].RenderStyle,d=this.ChannelInfo[i].DownSampleAlgorithm,g=d!==w.None&&c>5;t.globalCompositeOperation=u===m.Segment?"source-xor":"source-over";const y=f.pick(null,i);let x,b,v,_,B=this.d2gX(e),C=0,S=e,M={Color:this.ChannelInfo[i].Color||"black",Width:.1};t.strokeStyle=M.Color,t.fillStyle=M.Color,t.lineWidth=M.Width;let j=0!==y.get(0)?S:-1;switch(u){case m.Line:case m.Step:if(g){l.SetTransformRect(t,this.gBounds,n),v=-Number.MAX_VALUE,b=Number.MAX_VALUE,_=0,t.beginPath(),t.moveTo(B,y.get(0));for(let e=0;e<h;++e)if(x=y.get(e),a&&(this.AutoYAxisAdjustBehaviour===A.EnsureAllSamplesVisible?x>r?r=x:x<o&&(o=x):o=r=x,e==h-1&&(p=x)),x>v?v=x:x<b&&(b=x),_+=x,e-C>=c){switch(d){case w.MinMax:t.lineTo(B,b),t.lineTo(B,v),t.lineTo(B+1,v);break;case w.Avg:t.lineTo(B,_/c);break;case w.Decimate:default:t.lineTo(B,x)}++B,v=-Number.MAX_VALUE,b=Number.MAX_VALUE,_=0,C=e}t.setTransform(1,0,0,1,this.gBounds.x,this.gBounds.y),t.lineWidth=1,t.lineJoin="miter",t.stroke()}else{l.SetTransformRect(t,this.gBounds,s),t.beginPath();let e=y.get(0);u===m.Step?t.lineTo(S,e):t.moveTo(S,e);const i=this.sampleDuration;for(let s=0;s<h;++s){const n=y.get(s);u===m.Step&&t.lineTo(S,n),S+=i,a&&(this.AutoYAxisAdjustBehaviour===A.EnsureAllSamplesVisible?n>r?r=n:n<o&&(o=n):o=r=n,s==h-1&&(p=n)),u===m.Step?t.lineTo(S,n):(t.quadraticCurveTo(S+i/4,e,S+i/2,(e+n)/2),t.quadraticCurveTo(S+3*i/4,n,S+i,n)),e=n}t.setTransform(1,0,0,1,this.gBounds.x,this.gBounds.y),t.lineWidth=1,t.stroke()}break;case m.Segment:l.SetTransformRect(t,this.gBounds,s);for(let e=1;e<h;++e){S+=this.sampleDuration;const i=0!==y.get(e);j>=0?i||(t.fillRect(j,s.y,S-j,s.height),j=-1):i&&(j=S)}j>=0&&t.fillRect(j,s.y,S-j,s.height)}}t.restore(),this.AutoYAxisAdjustBehaviour===A.EnsureMostRecentSampleVisible?(p/=this.SampleUnitMultiplier,p>this.maxY?(r=p,o=p-(this.maxY-this.minY)):p<this.minY&&(o=p,r=p+(this.maxY-this.minY))):(r/=this.SampleUnitMultiplier,o/=this.SampleUnitMultiplier);const g=this.maxY!=r||this.minY!=o;return this.maxY=r,this.minY=o,g}pixels2duration(t){return this.dBounds.width*t/this.gBounds.width}samples_per_pixel(){return this.dBounds.width/this.gBounds.width*this.Fs}time2pixels(t){return this.d2gX(t)}d2gX(t){return Math.round(this.gBounds.width*t/this.dBounds.width-this.dBounds.x*this.gBounds.width/this.dBounds.width)}g2dY(t){return this.dBounds.height*t/this.gBounds.height}d2gY(t){return this.gBounds.height-this.gBounds.height*(t-this.dBounds.y)/this.dBounds.height}d2gHeight(t){return Math.round(t/this.dBounds.height*this.gBounds.height)}d2gWidth(t){return Math.round(t/this.dBounds.width*this.gBounds.width)}duration2pixels(t){return this.d2gWidth(t)}yAxis_Recalc(){const t=Math.floor(Math.log(Math.LN10));for(this.gridMajorY=Math.pow(10,t-1);this.d2gHeight(this.gridMajorY)>this.gBounds.height;)this.gridMajorY/=10;for(;this.d2gHeight(this.gridMajorY)<10*this.MIN_GRID_Y;)this.gridMajorY*=10;this.gridMinorY=this.gridMajorY/10,this.d2gHeight(this.gridMinorY)<this.MIN_GRID_Y&&(this.gridMinorY*=2)}timeAxis_Recalc(){const t=Math.floor(Math.log(this.dBounds.width)/Math.LN10);if(this.gridMajorX=Math.pow(10,t-1),this.gBounds.width>0)for(;this.duration2pixels(this.gridMajorX)<10*this.MIN_GRID_X;)this.gridMajorX*=10;this.gridMinorX=this.gridMajorX/10,this.gBounds.width>0&&this.duration2pixels(this.gridMinorX)<this.MIN_GRID_X&&(this.gridMinorX*=2)}RenderGraphGrid(t){const e=this.gBounds,i=this.dBounds;let s,n,r,o;for(t.save(),l.setClip(t,e),l.SetOrigin(t,e.x,e.y),n=this.gridMinorY*Math.floor(i.y/this.gridMinorY),o=n;o<i.y+i.height;o+=this.gridMinorY){const i=this.d2gY(o);l.DrawLine(t,this.penGridMinor,0,i,e.width,i)}for(n=this.gridMajorY*Math.floor(i.y/this.gridMajorY),o=n;o<i.y+i.height;o+=this.gridMajorY){const i=this.d2gY(o);l.DrawLine(t,this.penGridMajor,0,i,e.width,i)}for(s=this.gridMinorX*Math.floor(i.x/this.gridMinorX),r=s;r<i.x+i.width;r+=this.gridMinorX){const i=this.d2gX(r);l.DrawLine(t,this.penGridMinor,i,0,i,e.height)}for(s=this.gridMajorX*Math.floor(i.x/this.gridMajorX),r=s;r<i.x+i.width;r+=this.gridMajorX){const i=this.d2gX(r);l.DrawLine(t,this.penGridMajor,i,0,i,e.height)}t.restore()}AdjustYAxis(){const t=this.maxY,e=this.minY;if(t!=-Number.MAX_VALUE&&e<=t){const i=this.dBounds.height,s=this.dBounds.y,n=t-e;return this.AutoYAxisAdjustBehaviour===A.EnsureAllSamplesVisible&&n>0&&(n<i/4?this.DataHeight=this.DataHeight:n>i&&(this.DataHeight=n+n/4,this.dBounds.y=e-n/8)),(e<this.dBounds.y||t>this.dBounds.y+this.dBounds.height)&&(this.dBounds.y=e-(this.dBounds.height-n)/2),i!=this.dBounds.height||s!=this.dBounds.y}return!1}GetArea(t,e){return this.gBounds.Contains(t,e)?x.Graph:this.timeAxisBounds.Contains(t,e)?x.TimeAxis:this.yAxisBounds.Contains(t,e)?x.YAxis:x.BottomLeft}graph_Zoom(t,e){this.AutoYAxisAdjustBehaviour=A.None;const i=this.dragPoint.x-t,s=this.dragPoint.y-e;if(!(i<=1&&i>=-1&&s<=1&&s>=-1)){this.dragPoint.x=t,this.dragPoint.y=e;const n=i<0?1:-1,r=s<0?-1:1;if((i<0?-i:i)>(s<0?-s:s)){const t=(20-n)/20;this.onScreenCanvas.style.cursor="col-resize",this.DataWidth*=t,this.DataX+=this.DataWidth*(1/t-1)*this.dragStartPoint.x/this.gBounds.width}else{const t=(20-r)/20;this.onScreenCanvas.style.cursor="row-resize",this.DataHeight*=t,this.DataY+=this.DataHeight*(1/t-1)*.5}}}yAxis_Scroll(t){const e=this.dragPoint.y-t;this.DataY-=this.g2dY(e),this.dragPoint.y=t,e>0?this.onScreenCanvas.style.cursor="n-resize":e<0&&(this.onScreenCanvas.style.cursor="s-resize")}timeAxis_Scroll(t){const e=t-this.dragPoint.x;this.DataX-=this.pixels2duration(e),this.dragPoint.x=t,0===this.DataX?this.onScreenCanvas.style.cursor="not-allowed":e>0?this.onScreenCanvas.style.cursor="e-resize":e<0&&(this.onScreenCanvas.style.cursor="w-resize")}}!function(t){t[t.None=0]="None",t[t.Graph=1]="Graph",t[t.TimeAxis=2]="TimeAxis",t[t.YAxis=3]="YAxis",t[t.BottomLeft=4]="BottomLeft"}(x||(x={}));class v extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("div"),i=document.createElement("style");e.className="private-style1",i.textContent="\n        .private-style1 {\n        height: 100%;\n        width: 100%;\n        /*padding: 0;*/\n        /*margin :0;*/\n        /*    top: 0;*/\n        /*    bottom : 0;*/\n        /*    left: 0;*/\n        /*    right: 0;*/\n            \n        }\n",this.scope_=new b(e),t.append(i,e),window.addEventListener("resize",t=>{t.preventDefault(),this.scope_.Resize()}),this.scope_.Resize()}get Scope(){return this.scope_}}var _=i(1),B=i.n(_);class C{constructor(t,e,i,s){if(this.idx_=0,this.nBuffersRead_=0,this.sampleCount_=0,this.NUM_CHANNELS=e,this.SZ=t,void 0!==s)this.buf_=new s(2*t*e);else switch(i){case 8:this.buf_=new Uint8Array(2*t*e);break;case 16:this.buf_=new Int16Array(2*t*e);break;case 32:this.buf_=new Float32Array(2*t*e);break;default:case 64:this.buf_=new Float64Array(2*t*e)}this.reset()}get RowCount(){return this.sampleCount_/this.NUM_CHANNELS}get BuffersRead(){return this.nBuffersRead_}put(t){const e=this.buf_.length/2,i=t.length;let s=this.idx_;this.buf_.set(t,s);const n=s+i-e;n>0&&this.buf_.set(t.subarray(i-n),0),(s+=i)>=e&&(++this.nBuffersRead_,s-=e),this.idx_=s,this.sampleCount_+=i}index(t){return t%this.SZ*this.NUM_CHANNELS}raw_view(t,e){return t%=this.SZ,t*=this.NUM_CHANNELS,e*=this.NUM_CHANNELS,this.buf_.subarray(t,t+e)}view(t,e){const i=this.SZ;return t%=i,B()(this.buf_,[2*i,this.NUM_CHANNELS]).lo(t,0)}reset(){this.nBuffersRead_=this.idx_=this.sampleCount_=0}}class S extends p.a{constructor(t,e,i=16,s=Int16Array){super(),this.Fs=t,this.NumChannels=e,this.bits_per_sample=i,this.MeasuredFs=0,this.perf_start_frames_read=0,this.perf_start_time=0,this.buf_=new C(S.BUFFER_SIZE_SECONDS*this.Fs,this.NumChannels,i,s)}AddData(t){this.buf_.put(t),this.emit("data")}get HasData(){return this.buf_.RowCount>0}get CurrentTimeSecs(){return this.buf_.RowCount/this.Fs}get StartTimeSecs(){return this.buf_.BuffersRead*S.BUFFER_SIZE_SECONDS}get NumFramesRead(){return this.buf_.RowCount}Reset(){this.buf_.reset(),this.emit("data"),this.startPerformanceMeasurement()}Data(t,e){return this.buf_.view(t*this.Fs,e*this.Fs)}DataRaw(t,e){return this.buf_.raw_view(t*this.Fs,e*this.Fs)}FrameOffsetToIndex(t){return this.buf_.index(t)}TimeToIndex(t){return this.buf_.index(Math.round(t*this.Fs))}startPerformanceMeasurement(){this.perf_start_time=window.performance.now(),this.perf_start_frames_read=this.NumFramesRead}measurePerformance(){const t=window.performance.now(),e=(this.perf_start_time,this.Fs,this.NumFramesRead-this.perf_start_frames_read),i=e/((t-this.perf_start_time)/1e3);this.MeasuredFs=i}}S.BUFFER_SIZE_SECONDS=3600;class M extends S{constructor(t,e,i=16,s=Int16Array){super(t,e,i,s),this.bits_per_sample=i,this.statusListeners=[],this.informListeners=t=>{this.statusListeners.forEach(t=>{t.onConnectionStatus(this)}),setTimeout(()=>{this.informListeners(this)},250)},this.informListeners(this)}AddStatusListener(t){this.statusListeners.push(t)}RemoveStatusListener(t){const e=this.statusListeners.indexOf(t);e>=0&&this.statusListeners.splice(e,1)}set Url(t){this.url_=t,this.init(this.bits_per_sample)}get Url(){return this.url_}get Sock(){return this.sock_}init(t){this.sock_&&delete this.sock_;const e=new WebSocket(this.url_);switch(e.binaryType="arraybuffer",e.onopen=t=>{console.log(t),this.startPerformanceMeasurement()},e.onclose=e=>{console.log(e),setTimeout(()=>{this.init(t)},2e3)},t){case 16:e.onmessage=t=>{this.AddData(new Int16Array(t.data).subarray(1,2)),this.measurePerformance()};break;case 32:e.onmessage=t=>{this.AddData(new Float32Array(t.data)),this.measurePerformance()};break;case 64:e.onmessage=t=>{this.AddData(new Float64Array(t.data)),this.measurePerformance()};break;default:throw"Invalid bits per sample for websocket connection"}e.onerror=t=>{console.log(t)},this.sock_=e}}class j extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("canvas"),i=this.hasAttribute("channels")?Number.parseInt(this.getAttribute("channels")):1,s=this.hasAttribute("bits")?Number.parseInt(this.getAttribute("bits")):16,n=this.hasAttribute("sample-rate")?Number.parseInt(this.getAttribute("sample-rate")):1;this.conn_=new M(n,i,s),this.hasAttribute("url")&&(this.conn_.Url=this.getAttribute("url")),this.conn_.AddStatusListener(this),this.onConnectionStatus=t=>{e.setAttribute("width",window.getComputedStyle(e,null).getPropertyValue("width")),e.setAttribute("height",window.getComputedStyle(e,null).getPropertyValue("height")),e.height=18;let i="",s="#444444",n="";if(t.Sock){switch(t.Sock.readyState){case 3:n="closed    ",s="#444444";break;case 2:n="closing   ",s="#104700";break;case 1:n="open      ",s="#03ac00";break;case 0:n="connecting",s="#d4d400";break;default:n="unknown   ",s="#be0000"}if(i=i+"Connection: "+n+" ",1===t.Sock.readyState){i=i+"Fs="+t.MeasuredFs.toFixed(0)+" "}}else i+="Not connected, press [Connect] button.";const r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.font="14px Arial",r.fillStyle="#000000",r.textBaseline="middle",r.textAlign="right";r.fillText(i,e.width-12-4,e.height/2),j.drawLed(r,e.width-6-1,e.height/2,6,s)},t.append(e)}static drawLed(t,e,i,s,n){const r=i-s,o=t.createLinearGradient(0,r+s/5,0,r+4*s/5);o.addColorStop(0,"#ffffff"),o.addColorStop(1,n);const a=t.createLinearGradient(0,r,0,r+2*s);a.addColorStop(1,"#ffffff"),a.addColorStop(0,"#222222"),t.lineWidth=s/4,l.DrawCircle(t,a,e,i,s),l.FillCircle(t,n,e,i,s),l.FillEllipse(t,o,e,i-s/2,3*s/5,2*s/5)}set Url(t){this.conn_.Url=t,this.setAttribute("url",t)}get Url(){return this.conn_.Url}get Connection(){return this.conn_}}function D(t){const e=document.querySelectorAll(".page");for(const i of e)i.id===t?i.classList.remove("hidden"):i.classList.add("hidden")}!function(t=Array.prototype){if(!("length"in t))throw"Can't add algorithms to an object without 'length' property";if(void 0===t[Symbol.iterator])throw"Can't add algorithms to a non-iterable object ";Object.defineProperty(t,"randomElement",{value:function(){return this.length?this[Math.floor(Math.random()*this.length)]:void 0}}),Object.defineProperty(t,"shuffle",{value:function(){for(let t=this.length;t>0;){const e=Math.floor(Math.random()*t);--t;const i=this[t];this[t]=this[e],this[e]=i}return this}}),Object.defineProperty(t,"partition",{value:function(t){const e={};let i=0;for(const s of this){const n=t(s,i++,this);void 0===e[n]&&(e[n]=[]),e[n].push(s)}return e}})}(Array.prototype),customElements.define("custom-element",s),customElements.define("console-element",n),customElements.define("scope-element",v),customElements.define("websocket-element",j),document.addEventListener("contextmenu",t=>{t.preventDefault()}),document.querySelectorAll(".page-switcher").forEach(t=>{t.addEventListener("click",()=>{D(t.getAttribute("page")||"")})}),D("page-1");const T=document.querySelector("console-element");T.info("App Loaded.");const R=document.querySelector("scope-element"),E=document.querySelector("websocket-element"),F=R.Scope;F.ChannelInfo=[{Name:"EDA",Color:"#ffffff",Visible:!0,RenderStyle:m.Step,DownSampleAlgorithm:w.MinMax}],F.Fs=E.Connection.Fs,F.Connection=E.Connection,F.SampleUnitMultiplier=1,F.AutoYAxisAdjustBehaviour=A.EnsureAllSamplesVisible,F.AutoYAxisAdjustChannel=0,T.info("Connected scope to websocket.");const N=document.querySelector("#connect-button"),Y=document.querySelector("#status-indicator");N.addEventListener("click",async()=>{const t=await async function(t,e){const i=await fetch(`/open/${t}/${e}`,{method:"get",headers:{Accept:"application/json","Content-Type":"application/json"}});return await i.json()}(1240,61281);T.info(JSON.stringify(t,null,1))}),window.setInterval(()=>{(async()=>{const t=await async function(){const t=await fetch("/status",{method:"get",headers:{Accept:"application/json","Content-Type":"application/json"}});return await t.json()}();Y.innerText=t.status})()},2e3)}]);
//# sourceMappingURL=index.js.map